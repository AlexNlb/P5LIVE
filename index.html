<!DOCTYPE html>
<!-- <html manifest="cache.manifest"> -->
<head>
  <title>P5LIVE</title>
  <meta charset="utf-8">
  <link rel="icon" type="image/png" href="apple-touch-icon.png">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="P5LIVE">
  <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, minimal-ui">
  <style type="text/css">
    * {
      box-sizing: border-box;
    }
    ::selection {
      background-color: #fff;
    }
    html {
      margin: 0;
      padding: 0;
      width: 100vw;
      height: 100vh;
      font-family: 'Source Sans Pro', 'Open Sans', Roboto, 'Helvetica Neue', 'Segoe UI', 'Myriad Pro', Helvetica, Myriad, Arial, sans-serif;
    }
    body {
      margin: 0;
      padding: 0;
      width: 100vw;
      height: 100vh;
      color: #839496;
      background: #000;
      position: relative;
      background:#000;
    }
    
    #editor,
    #preview, canvas {
      position:fixed;
      top:0;
      left:0;
      width: 100vw;
      height:100vh;
      margin: 0;
      //z-index: -1;
      outline: none;
      background: none;
      border: none;
      box-sizing: border-box;

    }
    #editor {
      transition: background-color .1s ease-in-out;
      font-family: 'Monaco','Source Code Pro', Menlo, Consolas, monospace;
      color: #fff;
      padding: 25px;
      font-size: 3vw;
      //line-height: 1.3;
      z-index:1;
      mix-blend-mode:difference;
      will-change: opacity;
      -webkit-font-smoothing: antialiased;
      /*display:block;*/
      visibility: visible;
      box-sizing: border-box;
    }
    #preview {
      background: #000;
      appearance: none;
      z-index:-1;
      -webkit-user-select: none; /* Chrome/Safari */        
      -moz-user-select: none; /* Firefox */
      -ms-user-select: none; /* IE10+ */
    }
    #preview:hover,
    #preview:focus {
      opacity: 1;
      cursor: default;
    }
    header{
      display:none;
    }

    /* MENU */
    #menu{
      position:fixed;
      top:0;
      right:0;
      margin-right:-20vw;
      height:100vh;
      width:20vw;
      box-sizing: border-box;
      padding:15px;
      color:#fff;
      z-index:101;
      transition: margin-right .4s linear;
      mix-blend-mode:difference;

    }
    #menu-switch{
    	position:absolute;
    	font-size:2.5vw;
    	top:0;
    	left:-2.5vw;
    	height:100%;
    	cursor:pointer;
    	mix-blend-mode:difference;
    	color:#fff;
    	opacity:.1;
    	transition: opacity .5s linear;
    }
    #menu-switch:hover{
    	opacity:1;
    }
    #menu-bg{
    	position:absolute;
    	top:0;
    	left:0;
    	width:100%;
    	height:100%;
    	background:#333;
    	z-index:-1;
    	opacity: .5;
    }
    .menu-section{
    	margin:0 0 35px 0;
    }
    .menu-header{
      font-size:1.5vw;
      color:#fff;
      border-bottom:1px solid #fff;
      margin:0px 0 5px 0;
    }
    #menu-sketches-holder{
      color:#fff;
      height:50vh;
      overflow:auto;
      margin-left:15px;
    }
    #menu-sketches{
      height:100%;
    }
    #menu-sketches ul{
      padding-left:0px;
      list-style-type: none;
    }
    .menu-sketch{
      font-size:1vw;
      background:#444;
      margin:3px;
      padding:3px;
    }
    .sketch-selected{
      background:red;
    }
    #menu-settings{
      padding-left:15px;
    }
    #menu-settings div{
      margin-bottom:10px;
    }
    #menu-settings-fontsize{
      width:2em;
      font-size:1.25vw;
      text-align:center;
      color:#fff;
      border:none;
      outline:none;
      background:none;
      border-bottom:2px solid #fff;
    }

/* ACE EDITOR */
   /* 
    .ace_gutter-cell {
    	font-size:0px;

    }
    .ace-twilight, .ace_gutter{
    }
 

    .ace_gutter, .ace_gutter > .ace_layer {
    	//background:none;
        width: 20px !important;
    }*/

    footer {
      display:none;
      background: #073642;
      width: 100%;
      height: 30px;
      line-height: 30px;
      padding: 0 5px;
      position: fixed;
      bottom: 0;
      left: 0;
      z-index: 250;
    }
    footer .download {
      position: absolute;
      top: 50px;
      left: 50px;
    }
    @media (max-width: 481px) {
      header #brand {
        font-size: 10pt;
      }
      header #brand strong {
        display: none;
      }
    }
  </style>
    <script src="includes/p5/p5.min.js"></script>
    <script src="includes/p5/addons/p5.dom.min.js"></script>
    <script src="includes/p5/addons/p5.sound.min.js"></script>
    <script src="includes/p5/sketch.js"></script>
    <script src="includes/js/src-min-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
    <script src="includes/js/src-min-noconflict/ext-language_tools.js" type="text/javascript" charset="utf-8"></script>
    
</head>
<body>
  <section>
    <div id="preview"></div>
    <!-- <textarea id="editor" autofocus></textarea> -->
    <pre id="editor" autofocus>
      
    </pre>
    <div id="holdscript"></div>
  </section>
  <header>
    <span id="brand"><span id="filename"></span></span>
    <nav>
      <button id="save" onclick="exportNote()">save</button>
      <button id="switch" onclick="switchSketch()">switch</button>
    </nav>
  </header>
  <div id="menu">
  	<div id="menu-bg"></div>
  	<div id="menu-switch" onclick="menuToggle();">X</div>
    <div class="menu-section">
      <div id="menu-settings-header" class="menu-header">SETTINGS</div>
      <div id="menu-settings">
        <div>
          Font-Size: <input type="" name="menu-settings-fontsize" id="menu-settings-fontsize" value="2" onkeyup="fontSizeAdjust(this.value);"> vw
        </div>
        <div >
            <span style="cursor:help;" title="Prevents compiling unless strict Javascript is error free">Strict Compile:</span> 
            <input type="checkbox" id="settings-errormode" name="settings-errormode" value="settings-errormode" onchange="errorModeToggle();" >
        </div>
        <div>
            <span style="cursor:help;" title="Force new instance of P5JS on each compile">Instance Compile:</span> 
            <input type="checkbox" id="settings-hardcompile" name="settings-hardcompile" value="settings-hardcompile" onchange="hardCompileToggle();">
        </div>
        <div>
            <span style="cursor:help;" title="Compile code on each keypress">Auto Compile:</span> 
            <input type="checkbox" id="settings-automode" name="settings-automode" value="settings-automode" onchange="autoModeToggle();">
        </div>
         <div>
            <span style="cursor:help;" title="Toggle fullscreen mode">Fullscreen:</span> 
            <input type="checkbox" id="settings-fullscreen" name="settings-fullscreen" value="settings-fullscreen" onchange="fullscreenToggle();">
        </div>
        
      </div>
    </div>
    <div class="menu-section">
      <div id="menu-sketches-header" class="menu-header">SKETCHES</div>
      <div id="menu-sketches-holder">
        <div id="menu-sketches">
      
        </div>
      </div>
        <div>
          <button onclick="sketchesExport();">EXPORT</button>
          <!-- <input  onclick="sketchesImport();">IMPORT</button> -->
          <button onclick="document.getElementById('file-input').click();">IMPORT</button>
					<input id="file-input" type="file" name="name" style="display: none;" onchange="sketchesImport(this.files[0]);" />
        </div>
    </div>
   
  </div>
  <footer><a id="download" download="export.html"></a></footer>
  <textarea style="display:none;" id="p5-template">
function setup() {
	createCanvas(windowWidth, windowHeight);

}

function draw() {
	
}</textarea>
  <script type="text/javascript">

  	/*
	CMD KEYS
	CTRL + ENTER = refresh code
	CTRL + a = autocompile code
	CTRL + h = hide editor
	CTRL + f = fullscreen toggle
	CTRL + m = menu toggle
	CTRL + ENTER = refresh code
	CTRL + r = refresh p5js
  	*/

    /*
      TODO
      - pulldown of saved localstorage or new (check expirations)
      √- toggle nav
      √- add nav: auto/default text colors, fontsize
      - rename settings
      - cleanup un-necessary css/html
      - add about
      √- adjust font via settings menu
      - 
      √- really reset instance for various settings
      √- fix template not working on new
      √- fix key commands (font size)
      √- check reload issue with forloop / map??
      √- ease javascript for ';' and '!== vs !='
      √- build menu for settings, sketches
      √- remove, [ save as ??], sketches

      CREDITS
      p5.js - https://p5js.org
      tinkerpad (just localstorage idea?) - https://github.com/tomhodgins/tinkerpad
      ace editor - https://ace.c9.io
    */


    // init localStorage
    var reset = false;

    if(reset){
      localStorage.removeItem("sketches");
      localStorage.removeItem("settings");
    }
    if(localStorage.getItem("sketches") == null){
       localStorage.setItem("sketches", "default");
    }
    if(localStorage.getItem("settings") == null){
        localStorage.setItem("settings", JSON.stringify({"fontSize":3, "editColor":"rgb(255, 255, 255)", "autoColor":"rgb(100, 255, 100)", "autoMode":false, "hardCompile":true}));
    }

    var editorPane = document.getElementById('editor'),
        previewPane = document.getElementById('preview'),
        downloadLink = document.getElementById('download'),
        p5template = document.getElementById('p5-template'),
        p5script = document.getElementById("holdscript"),
        menuSketches = document.getElementById('menu-sketches'),
        menuSettings = document.getElementById('menu-settings'),
        settingsErrorMode = document.getElementById('settings-errormode'),
        settingsAutoMode = document.getElementById('settings-automode'),
        settingsFullscreen = document.getElementById('settings-fullscreen'),
        settingsHardCompile = document.getElementById('settings-hardcompile'),
        settingsFontsize = document.getElementById('menu-settings-fontsize');
        menuPanel = document.getElementById('menu'),
        menuSwitch = document.getElementById('menu-switch'),
        menuMode = true, //*temp
        fileName = '',
        sketches = getSketches(", "),
        settings = getSettings(),
        errorMode = settings.errorMode, 
        autoMode = settings.autoMode, 
        fullscreenMode = false,
        validCode = true, 
        hardCompile = settings.hardCompile,
        debugMode = true,
        sketchLoaded = false,
        pLen = 0, 
        p5;
        
    //autoMode = true;
    var editor = ace.edit("editor");
    editor.setTheme("ace/theme/twilight");
    editor.session.setMode("ace/mode/javascript");
    editor.setOptions({
    	showPrintMargin: false,
    	animatedScroll: false,
    	displayIndentGuides: false,
    	useWorker: false, // investigate
    	showLineNumbers: false,
    	showGutter: false,
    	//enableLiveAutocompletion:true,
    	//fixedWidthGutter: true,
    });
    //editor.session.$worker.send("changeOptions", [{asi: true}]);

      // init sketches
    editorPane.style.visibility = "visible";


    // load stored settings
    loadSettings();


    // stylize editor gutter
	  var gut = document.getElementsByClassName("ace_gutter");
		for (var i = 0; i < gut.length; i++) {
	  		//gut[i].style.background = "none";
		}


   	// compile if no errors
    editor.session.on('changeMode', function(e, session){
      if ("ace/mode/javascript" === session.getMode().$id) {
        if (!!session.$worker) {
          session.$worker.send("changeOptions", [{
            asi: true,
          }]);
        }
      }
    });

    // prevent compile if bad code
    editor.getSession().on("changeAnnotation", function(){
      var annot = editor.getSession().getAnnotations();
      if(annot.length == 0){
        validCode = true;
      }else{
        validCode = false;
      }
    });


    // CMD-KEYS (remove key conflicts)
    editor.commands.removeCommands(["gotoright","movelinesup", "movelinesdown", "gotolinestart", "splitline"]);

   // replace backspace w/o ctrl + h
   editor.commands.addCommand({
    name: "backspace",
    bindKey: { win: "Shift-Backspace|Backspace", mac: "Ctrl-Backspace|Shift-Backspace|Backspace" },
    exec: function(e) { e.remove("left") },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor"
   });

   //replace gotoright w/o ctrl + f
   editor.commands.addCommand({
    name: "gotoright",
    bindKey: { win: "Right", mac: "Right" },
    exec: function(e,t) { e.navigateRight(t.times) },
    multiSelectAction: "forEach",
    scrollIntoView: "cursor",
    readOnly:!0
   });


   if(debugMode)
   	listCommands();

   function listCommands(){
   	var cmds = editor.commands.commands;
   	var k = [];
   	for (var cmd in cmds){
   		k.push(cmd.name +" = "+ cmd.bindKey);
   	}

   	console.log(cmds);
   }

   // check storageKeys
    if(debugMode)
			getKeys();
    
    function getKeys(){
      var k = [];
      for (var key in localStorage){
         k.push(key);
      }
      console.log(k.join(", "));
    }

  
    // Get settings
    function getSettings(){
      return JSON.parse(localStorage.getItem('settings'));
    }

    // Load settings
    function loadSettings(){

    	// fontSize
			editorPane.style.fontSize = settings.fontSize+"vw";
    	
    	// load toggles
			hardCompileUpdate();
    	errorModeUpdate();
    	autoModeUpdate();
    	fullscreenUpdate();
    	menuUpdate();
    }

    // Save settings
    function updateSettings(){
      localStorage.setItem('settings', JSON.stringify(settings));
    }

    // FIX TRASHED SKETCHES
    // sketches = ["flashy", "t2", "text", "sin2", "t3", "test4", "linetype", "3d", "baselcodes", "test2", "yeehaw", "yehaw", "typeline", "test", "scratchpad", "mic", "yui", "test6", "default", "textlive", "yup", "blip", "t1", "sketches", "live", "box", "newdemo", "blah", "pageTime", "blipblah"];
    // updateSketches();

    // Update Sketches
    function updateSketches(){
      localStorage.setItem("sketches", sketches.join(", ")); 
      updateMenu();
    }

    // Load Sketches collection
    function getSketches(splitter){
      var sketchesSplit = localStorage.getItem("sketches").split(splitter);
      return sketchesSplit.filter(Boolean);
    }

    function loadSketch(sketch){
      editor.setValue(localStorage[sketch], 1);
      fileName = sketch;
      updateMenu();
      updateP5(hardCompile);
      editor.focus();
    }

    // Remove Sketch
    function removeSketch(sketch){
        var doubleCheck = confirm("Are you sure you want to delete: " +sketch+" ?");
          if(doubleCheck){
            localStorage.removeItem(sketch);
            var index = sketches.indexOf(sketch);    // <-- Not supported in <IE9
            if (index !== -1) {
                sketches.splice(index, 1);
            }
            //console.log(index);
            updateSketches();
            updateMenu();
          }
    }

    function sketchesExport(){
    	var jsonExport = {};
    	jsonExport.sketches = [];
    	for(var i=0; i < sketches.length; i++){
    		jsonExport.sketches.push({"sketchName":sketches[i], "sketchCode":localStorage.getItem(sketches[i])});
      }
      jsonExport.settings = settings;
      var dateStamp = (new Date()).toISOString().replace(/[^0-9]/g, "").slice(0, -3);
      saveJSON(jsonExport, 'p5live_'+dateStamp+'.json');
      if(debugMode)
      	console.log(jsonExport);
    }

    function sketchesImport(data){
    	var reader = new FileReader();
			reader.onload = function(data) {
		    var jsonObj = JSON.parse(event.target.result);
		    console.log(jsonObj); // WOOHOOO use for import!
		  }

		  reader.readAsText(data);
    }

    function sketchesImportLoad(file){
    // 	if (file.type === 'text') {
    // 		console.log(file);
    // 		//createP(file.data);
  		// }
    	// loadJSON(url, function(){

    	// });
    }

    function updateMenu(){
      // sketches
      var sketchesSplit = localStorage.getItem("sketches").split(', ');
      var menuSketchesHTML = "";
      for(var i=0; i < sketchesSplit.length; i++){
        var selClass = "";
        if(sketchesSplit[i] == fileName){
          selClass = 'sketch-selected';
        }
        menuSketchesHTML += '<li class="menu-sketch '+selClass+'">'+sketchesSplit[i]+' // <a onclick="loadSketch(\''+sketchesSplit[i]+'\')">LOAD</a> // <a onclick="removeSketch(\''+sketchesSplit[i]+'\')">REMOVE</a></li>';
      }
      menuSketches.innerHTML = '<ul>'+ menuSketchesHTML +'</ul>';

      // settings
      //var settingsHTML = 'input'settings.fontSize
      //menuSettings.innerHTML = "";
    }

    // Editor Interactions
    onload = editorPane.onkeyup = function() {
      //console.log(Object.keys(localStorage));
      if(fileName == ''){ switchSketch() };
      if(autoMode){
      	// only refresh if new content typed
      	var cLen = editor.getValue().length;
      	console.log(cLen +" / "+ pLen);
      	if(cLen != pLen){
      		pLen = cLen;
      		refreshView();
      	}
      }
      localStorage[fileName] = editor.getValue();
     // console.log('hi');
      //document.body.id = 'preview';
      //tapZap();
    };
   
    // editorPane.onfocus= function() {
    //   this.style.webkitTransform = 'translate3D(0px, -10000px,0)';
    //   webkitRequestAnimationFrame(function() {
    //     this.style.webkitTransform = '';
    //   }.bind(this));
    // };

    editorPane.onkeydown = function(event) {
    	// check length of editor
    	pLen = editor.getValue().length;

    	if(debugMode)
      		console.log(event);
      if((event.key == '+' || event.key == '=' )&& event.ctrlKey){ // up arrow = bigger font
        fontSizeAdjust(parseFloat(settings.fontSize) + 0.25);
        event.preventDefault();
      }else if((event.key == '-') && event.ctrlKey){ // down arrow = smaller font
        fontSizeAdjust(parseFloat(settings.fontSize) - 0.25);
        event.preventDefault();
      }else if(event.keyCode == 65 && event.ctrlKey){ // a = auto compile
        autoModeToggle();
        event.preventDefault();
      }
    }

     window.onkeydown = function(event) {
      if(event.keyCode == 72 && event.ctrlKey){ // h = hide
        editorToggle();
        event.preventDefault();
      }else if(event.keyCode == 79 && event.ctrlKey){ // o = open
        switchSketch();
        event.preventDefault();
      }else if(event.keyCode == 77 && event.ctrlKey){ // m = menu
        menuToggle();
        event.preventDefault();
      }else if(event.keyCode == 70 && event.ctrlKey){ // f = fullscreen
        fullscreenToggle();
        event.preventDefault();
      }else if(event.keyCode == 82 && event.ctrlKey){ // r = auto compile
        //refreshView();
        updateP5(true);
        editorPane.focus();
        event.preventDefault();
      }else if(event.keyCode == 13 && event.ctrlKey){ // enter = recompile
        refreshView();
        event.preventDefault();
      }
    }

    // loop/noLoop on window blur
    window.onblur = function () { noLoop(); }
		window.onfocus = function () { loop(); }

    // Editor Functions
    function refreshView() {
      updateP5(hardCompile);
      editorPane.focus();
    }

    function updateP5(compileMode){
      if(validCode || !errorMode){
      	sketchLoaded = false;
        p5script.innerHTML = "";
        
        if(compileMode){
	        p5RemoveHack();
	        var ps = document.createElement("script");
	        ps.type = "text/javascript";
	        ps.src = "includes/p5/p5.min.js";
	        p5script.appendChild(ps);
	        
	        var ps2 = document.createElement("script");
	        ps.type = "text/javascript";
	        ps.src = "includes/p5/addons/p5.dom.min.js";
	        p5script.appendChild(ps2);
        }
        var s = document.createElement("script");
        s.type = "text/javascript";
        s.innerHTML = editor.getValue();
        p5script.appendChild(s);

        if(!hardCompile)
        	setup();
        sketchLoaded = true;
      }
    }

    // GoToLoop » https://codepen.io/GoSubRoutine/pen/ZBPjdP
    function p5RemoveHack() {
      if (window.p5 && p5.instance) {
        p5.instance.remove();
        p5.instance = window.setup = window.draw = null;
      } else {
        const canv = document.querySelector('canvas');
        canv && canv.remove();
      }
    }

    function errorModeToggle(){
    	errorMode = !errorMode;
      errorModeUpdate();
    }

    function errorModeUpdate(){
    	checkToggle("errorMode", errorMode, settingsErrorMode);
    	if(errorMode){
              //editor.session.setOption("showGutter", true);
              editor.renderer.setShowGutter(true); 
              editor.session.setOption("useWorker", true);
        }else{
              //editor.session.setOption("showGutter", false);
              //editor.renderer.setShowGutter(true); 
              editor.renderer.setShowGutter(false);
              editor.session.setOption("useWorker", false);
      }
    }


    function autoModeToggle(){
    	autoMode = !autoMode;
   		autoModeUpdate();
    }

    function autoModeUpdate(){
    	checkToggle("autoMode", autoMode, settingsAutoMode);
      if(autoMode){
      	editor.setTheme("ace/theme/gob");
      }else{
      	editor.setTheme("ace/theme/twilight");
      }
    }

    function fullscreenToggle(){
	    fullscreenMode = !fullscreenMode;
			fullscreenUpdate();
    }

    function fullscreenUpdate(){
    	checkToggle("fullscreenMode", fullscreenMode, settingsFullscreen);
      if(fullscreenMode){
        const canv = document.querySelector('canvas');
        canv.style.top = 0;
        if(sketchLoaded)
        	fullscreen(true);
        editorUpdate();
      }else{
      	if(sketchLoaded)
        	fullscreen(false);
      }
    }

    function hardCompileToggle(){
    	hardCompile = !hardCompile;
    	hardCompileUpdate();
    }

    function hardCompileUpdate(){
    	checkToggle("hardCompile", hardCompile, settingsHardCompile);
    }


    // generic checkbox function
    function checkToggle(checkName, checkVar, checkElm){
    	//checkVar = !checkVar;
    	if(checkVar){
				checkElm.checked = true;
    	}else{
				checkElm.checked = false;
    	}
    	settings[checkName] = checkVar;
    	updateSettings();
    	if(debugMode){
				console.log(checkName+": "+checkVar);
    	}
    }

    // hide/show editor
    function editorToggle(){
    	if(editorPane.style.visibility != "visible"){
        editorPane.style.visibility = "visible";
      }else{
        editorPane.style.visibility = "hidden";
      }
      editorUpdate();
    }

    function editorUpdate(){
      if(editorPane.style.visibility != "visible"){
        editor.focus();
      }else{
        const canv = document.querySelector('canvas');
        canv.focus();
      }
    }

    // hide/show menu
    function menuToggle(){
      menuMode = !menuMode;
      menuUpdate();
    }

    function menuUpdate(){
    	if(!menuMode){
        menuPanel.style.marginRight = "-20vw";
        menuSwitch.innerHTML = "☰";
      }else{
        menuPanel.style.marginRight = "0vw";
        menuSwitch.innerHTML = "X";
      }
    }

    // adjust fontsize
    function fontSizeAdjust(newVal){
      settings.fontSize = newVal;
      updateSettings();
      fontSizeUpdate();
    }

    function fontSizeUpdate(){
    	if(settingsFontsize !== document.activeElement)
      	settingsFontsize.value = settings.fontSize;
			editorPane.style.fontSize = settings.fontSize + "vw";
    }

    // switch sketches
    function switchSketch() {
      fileName = prompt('P5LIVE\nThis is a quick + dirty p5.js live-coding environment.\n\nDefault Sketch:\nPress \'OK\' or \'Cancel\'\n\nNew Sketch:\nType name and press \'OK\'\n\nOpen Sketch:\nType name of saved sketch and press \'OK\'\n\nSaved Sketches:\n' + getSketches(",  "), '');
      if(fileName == null || fileName == '') { 
        fileName = 'default'; //editor.setValue("hi"); // p5template.value
        localStorage[fileName] = p5template.value;
        editor.setValue(localStorage[fileName], 1);
        editor.gotoLine(7, 1, false);
        editor.focus();
      }else{
	      if(localStorage[fileName] != ''){ 
	        if (sketches.indexOf(fileName) === -1) {
	          sketches.unshift(fileName);
	          updateSketches();
	          if(editor.getValue().length > 86){ // 86 = template length
			         localStorage[fileName] = editor.getValue();
			      }else{
			      	editor.setValue(p5template.value);
			      }
	          //editor.setValue(p5template.value);
	        }else{
	          editor.setValue(localStorage[fileName], 1);
	        }
	        editor.focus(); 
	      }
    	}
      //console.log(editor);
      // if(editor.getValue().length < 1){
      //   editor.setValue(p5template.value); 
      // }
      downloadLink.setAttribute('download', fileName + '.html');
      document.getElementById('filename').innerHTML = ': ' + fileName;
      document.title = 'P5LIVE - ' + fileName;
      refreshView();
      updateMenu();
    };

   

   

    function exportNote() {
      downloadLink.href = 'data:text/html;charset=utf-8,' + encodeURIComponent(editor.getValue());
      downloadLink.click();
    };

   
  </script>
</body>
</html>